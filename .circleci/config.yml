version: 2

general:
  branches:
    ignore:
      - gh-pages
      - coverity_scan

step-library:
  - &install-brew-deps
      run:
        name: Install Dependencies via Homebrew
        command: |
          brew update
          brew uninstall libtool
          brew install libtool
          brew install gengetopt help2man
  - &test
      run:
        name: Run Tests
        command: |
          make check
          make dist

jobs:
  build-elcapitan:
    macos:
      xcode: "9.0"
      steps:
        - checkout
        - run:
            name: Install Dependencies via Homebrew
            command: |
              brew update
              brew uninstall libtool
              brew install libtool
              brew install gengetopt help2man
        - run: MacOSX/build
        - run:
            name: Run Tests
            command: |
              make check
              make dist
  build-sierra:
    macos:
      xcode: "8.0"
      steps:
        - checkout
        - run:
            name: Install Dependencies via Homebrew
            command: |
              brew update
              brew uninstall libtool
              brew install libtool
              brew install gengetopt help2man
        - run: MacOSX/build
        - run:
            name: Run Tests
            command: |
              make check
              make dist
          
workflows:
  version: 2
  build-and-test:
    jobs:
      - build-elcapitan
      - build-sierra

